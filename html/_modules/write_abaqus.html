<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>write_abaqus &mdash; homogenised-finite-elements 0.9.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/documentation_options.js?v=39bb1c6d"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            homogenised-finite-elements
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html#homogenised-finite-elements-pipeline">Homogenised Finite Elements Pipeline</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">homogenised-finite-elements</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">write_abaqus</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for write_abaqus</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Literal</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">LOGGING_NAME</span> <span class="o">=</span> <span class="s2">&quot;HFE-ACCURATE&quot;</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">LOGGING_NAME</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">propagate</span> <span class="o">=</span> <span class="kc">False</span>


<span class="c1"># flake8: noqa: E501</span>


<div class="viewcode-block" id="timefunc">
<a class="viewcode-back" href="../write_abaqus.html#write_abaqus.timefunc">[docs]</a>
<span class="k">def</span> <span class="nf">timefunc</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="n">round_el_time</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">elapsed_time</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">part_name</span><span class="si">}</span><span class="s2"> took </span><span class="si">{</span><span class="n">round_el_time</span><span class="si">}</span><span class="s2"> s to execute.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">return</span> <span class="n">wrapper</span></div>



<div class="viewcode-block" id="AbaqusWriter">
<a class="viewcode-back" href="../write_abaqus.html#write_abaqus.AbaqusWriter">[docs]</a>
<span class="k">class</span> <span class="nc">AbaqusWriter</span><span class="p">:</span>
<div class="viewcode-block" id="AbaqusWriter.__init__">
<a class="viewcode-back" href="../write_abaqus.html#write_abaqus.AbaqusWriter.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">cfg</span><span class="p">,</span>
        <span class="n">mesh_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">nodes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span>
        <span class="n">elms</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
        <span class="n">centroids_cort</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span>
        <span class="n">centroids_trab</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span>
        <span class="n">m_cort_np</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">m_trab_np</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">RHOc</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">RHOt</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">PHIc</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">PHIt</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">mm_cort</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">mm_trab</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">topnodes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">botnodes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">RP_tag</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">RP_coords</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
        <span class="n">NLGEOM</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">STEP_INC</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">PARAM_FLAG</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">DENSIFICATOR_FLAG</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">VISCOSITY_FLAG</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">POSTYIELD_FLAG</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes an instance of the AbaqusWriter class.</span>

<span class="sd">        Args:</span>
<span class="sd">        - config: Dictionary containing the configuration parameters for the whole pipeline.</span>
<span class="sd">        - mesh_dir: Path to the directory containing the mesh files.</span>
<span class="sd">        - model_name: a string containing the name of the model. # ! to be substituted with the name coming from the config</span>
<span class="sd">        - nodes: a dictionary containing the node IDs and their corresponding coordinates.</span>
<span class="sd">        - elms: a dictionary containing the element IDs and their corresponding node IDs.</span>
<span class="sd">        - centroids: a dictionary containing the element IDs and their corresponding centroids.</span>
<span class="sd">        - botnodes: a dictionary containing the bottom nodes of the model.</span>
<span class="sd">        - topnodes: a dictionary containing the top nodes of the model.</span>
<span class="sd">        - RP_tag: an integer representing the tag of the reference point.</span>
<span class="sd">        - RP_coords: a list containing the coordinates of the reference point.</span>
<span class="sd">        - NLGEOM: a string indicating whether or not to use non-linear geometry.</span>
<span class="sd">        - STEP_INC: an integer representing the step increment for the simulation.</span>
<span class="sd">        - PARAM_FLAG: an integer representing the parameter selection (0: TRABECULAR BONE ISOTROPIC, 1: TRABECULAR BONE TRANSVERSELY ISOTROPIC, 2: TRABECULAR BONE FABRIC-BASED ORTHOTROPIC, 3: COMPACT BONE ISOTROPIC, 4: COMPACT BONE TRANSVERSELY ISOTROPIC)</span>
<span class="sd">        - DENSIFICATOR_FLAG: an integer activating the densificator in the UMAT (0: off, 1: on)</span>
<span class="sd">        - VISCOSITY_FLAG: an integer representing the viscosity flag (0: RATE-INDEPENDENT, 1: LINEAR VISCOSITY, 2: EXPONENTIAL VISC, 3: LOGARITHMIC VISC, 4: POLYNOMIAL VISC, 5: POWER LAW VISC)</span>
<span class="sd">        - POSTYIELD_FLAG: an integer representing the postyield behaviour (0 - PERFECT PLASTICITY, 1: EXPONENTIAL HARDENING, 2: SIMPLE SOFTENING, 3: EXPONENTIAL SOFTENING, 4: PIECEWISE SOFTENING, 5: LINEAR HARDENING)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">cfg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">=</span> <span class="n">model_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_dir</span> <span class="o">=</span> <span class="n">mesh_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">nodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elms</span> <span class="o">=</span> <span class="n">elms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">centroids_cort</span> <span class="o">=</span> <span class="n">centroids_cort</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">centroids_trab</span> <span class="o">=</span> <span class="n">centroids_trab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_cort_np</span> <span class="o">=</span> <span class="n">m_cort_np</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_trab_np</span> <span class="o">=</span> <span class="n">m_trab_np</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RHOc</span> <span class="o">=</span> <span class="n">RHOc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RHOt</span> <span class="o">=</span> <span class="n">RHOt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PHIc</span> <span class="o">=</span> <span class="n">PHIc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PHIt</span> <span class="o">=</span> <span class="n">PHIt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mm_cort</span> <span class="o">=</span> <span class="n">mm_cort</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mm_trab</span> <span class="o">=</span> <span class="n">mm_trab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">botnodes</span> <span class="o">=</span> <span class="n">botnodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topnodes</span> <span class="o">=</span> <span class="n">topnodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">part_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RP_tag</span> <span class="o">=</span> <span class="n">RP_tag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RP_coords</span> <span class="o">=</span> <span class="n">RP_coords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">STEP_INC</span> <span class="o">=</span> <span class="n">STEP_INC</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NLGEOM</span> <span class="o">=</span> <span class="n">NLGEOM</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abq_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_flag</span> <span class="o">=</span> <span class="n">PARAM_FLAG</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">densificator_flag</span> <span class="o">=</span> <span class="n">DENSIFICATOR_FLAG</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viscosity_flag</span> <span class="o">=</span> <span class="n">VISCOSITY_FLAG</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">postyield_flag</span> <span class="o">=</span> <span class="n">POSTYIELD_FLAG</span></div>


<div class="viewcode-block" id="AbaqusWriter._write_header">
<a class="viewcode-back" href="../write_abaqus.html#write_abaqus.AbaqusWriter._write_header">[docs]</a>
    <span class="k">def</span> <span class="nf">_write_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes the header section of the Abaqus input file.</span>

<span class="sd">        Returns:</span>
<span class="sd">        - A string containing the header section of the Abaqus input file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">header</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;*Heading</span>
<span class="s2">    ** HFE-ACCURATE SIMULATION INPUT FILE</span>
<span class="s2">    ** Model name: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">site_bone</span><span class="si">}</span><span class="s2">)</span>
<span class="s2">    ** Generated by Simone Poncioni, MSB</span>
<span class="s2">    * Preprint, echo=YES, model=NO, history=NO, contact=NO</span>
<span class="s2">    &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">header</span><span class="p">)</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="AbaqusWriter._write_parts">
<a class="viewcode-back" href="../write_abaqus.html#write_abaqus.AbaqusWriter._write_parts">[docs]</a>
    <span class="k">def</span> <span class="nf">_write_parts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes the parts section of the Abaqus input file.</span>

<span class="sd">        Returns:</span>
<span class="sd">        - A string containing the parts section of the Abaqus input file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="s2">&quot;**</span><span class="se">\n</span><span class="s2">** PARTS</span><span class="se">\n</span><span class="s2">**</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">parts</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;*Part, name=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">part_name</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">parts</span></div>


<div class="viewcode-block" id="AbaqusWriter._write_nodes">
<a class="viewcode-back" href="../write_abaqus.html#write_abaqus.AbaqusWriter._write_nodes">[docs]</a>
    <span class="k">def</span> <span class="nf">_write_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes the nodes section of the Abaqus input file.</span>

<span class="sd">        Args:</span>
<span class="sd">        - nodes: a dictionary containing the node IDs and their corresponding coordinates.</span>

<span class="sd">        Returns:</span>
<span class="sd">        - A string containing the nodes section of the Abaqus input file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nodes_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;*Node</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">nodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">nodes_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">value</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">nodes_str</span></div>


<div class="viewcode-block" id="AbaqusWriter._get_depvars">
<a class="viewcode-back" href="../write_abaqus.html#write_abaqus.AbaqusWriter._get_depvars">[docs]</a>
    <span class="k">def</span> <span class="nf">_get_depvars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nb_depvars</span><span class="o">=</span><span class="mi">26</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes the DEPVAR section of the Abaqus input file.</span>

<span class="sd">        Args:</span>
<span class="sd">        - nb_depvars: an integer representing the number of dependent variables.</span>

<span class="sd">        Returns:</span>
<span class="sd">        - A string containing the DEPVAR section of the Abaqus input file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">depvars</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;2, DMG, Damage</span>
<span class="s2">15, BVTVc, BVTVC</span>
<span class="s2">16, BVTVt, BVTVT</span>
<span class="s2">17, PBVc, PBVC</span>
<span class="s2">18, PBVt, PBVT</span>
<span class="s2">22, OFvalue, OF</span>
<span class="s2">23, F11, F11</span>
<span class="s2">24, F12, F12</span>
<span class="s2">25, F13, F13</span>
<span class="s2">26, F21, F21</span>
<span class="s2">27, F22, F22</span>
<span class="s2">28, F23, F23</span>
<span class="s2">29, F31, F31</span>
<span class="s2">30, F32, F32</span>
<span class="s2">31, F33, F33&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">depvars</span><span class="p">)</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="AbaqusWriter._write_elset">
<a class="viewcode-back" href="../write_abaqus.html#write_abaqus.AbaqusWriter._write_elset">[docs]</a>
    <span class="k">def</span> <span class="nf">_write_elset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elms</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes the ELSET section of the Abaqus input file.</span>

<span class="sd">        Args:</span>
<span class="sd">        - elms: a dictionary containing the element IDs and their corresponding node IDs.</span>

<span class="sd">        Returns:</span>
<span class="sd">        - A string containing the ELSET section of the Abaqus input file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">elset</span> <span class="o">=</span> <span class="s2">&quot;**</span><span class="se">\n</span><span class="s2">** ELSETS</span><span class="se">\n</span><span class="s2">**</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">elms</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">elset</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;*Elset, elset=Elset-</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">elset</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">elset</span></div>


<div class="viewcode-block" id="AbaqusWriter._set_orientation">
<a class="viewcode-back" href="../write_abaqus.html#write_abaqus.AbaqusWriter._set_orientation">[docs]</a>
    <span class="k">def</span> <span class="nf">_set_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orientation</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">centroids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the orientation of the element based on the given orientation and centroids.</span>
<span class="sd">        Orientation offset sets the coordinate system at the centroid of the element.</span>

<span class="sd">        Args:</span>
<span class="sd">        orientation (np.ndarray): The orientation of the element as a 3x3 matrix.</span>
<span class="sd">        centroids (list[float]): The centroids of the element as a list of three floats.</span>

<span class="sd">        Returns:</span>
<span class="sd">        np.ndarray: The orientation of the element with the centroids added to it.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">orientation_r</span> <span class="o">=</span> <span class="n">orientation</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="c1"># sum the centroid&#39;s coordinates to the orientation (twice)</span>
        <span class="n">orientation_offset</span> <span class="o">=</span> <span class="n">orientation_r</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">centroids</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Add the last three values of the orientation</span>
        <span class="n">orientation_offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orientation_offset</span><span class="p">,</span> <span class="n">centroids</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">orientation_offset</span></div>


<div class="viewcode-block" id="AbaqusWriter._set_orientation_new">
<a class="viewcode-back" href="../write_abaqus.html#write_abaqus.AbaqusWriter._set_orientation_new">[docs]</a>
    <span class="k">def</span> <span class="nf">_set_orientation_new</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orientation</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the orientation of the element based on the given orientation and centroids.</span>
<span class="sd">        Orientation offset sets the coordinate system at the centroid of the element.</span>

<span class="sd">        Args:</span>
<span class="sd">        orientation (np.ndarray): The orientation of the element as a 3x3 matrix.</span>

<span class="sd">        Returns:</span>
<span class="sd">        np.ndarray: The orientation of the element.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">orientation</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">orientation</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">orientation</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">orientation</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">orientation</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">orientation</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># round to 3 decimals # TODO: test functionality (is this necessary?)</span>
        <span class="n">mm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">mm</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mm</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span></div>


<div class="viewcode-block" id="AbaqusWriter._write_orientation">
<a class="viewcode-back" href="../write_abaqus.html#write_abaqus.AbaqusWriter._write_orientation">[docs]</a>
    <span class="k">def</span> <span class="nf">_write_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">abq_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes the orientation definition for each element set in the input dictionary.</span>

<span class="sd">        Args:</span>
<span class="sd">        - elms (dict[int, list[int]]): A dictionary containing the element sets for each element.</span>

<span class="sd">        Returns:</span>
<span class="sd">        - orientation (str): A string containing the orientation definition for each element set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">orientation</span> <span class="o">=</span> <span class="s2">&quot;**</span><span class="se">\n</span><span class="s2">** ORIENTATIONS</span><span class="se">\n</span><span class="s2">**</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1"># Loop over each element set in the input dictionary</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">abq_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># orientation += f&quot;*Orientation, name=Orient-{key}, SYSTEM=RECTANGULAR, DEFINITION=COORDINATES\n&quot;</span>
            <span class="n">orientation</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;*Orientation, name=Orient-</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="c1"># ori = self._set_orientation(value[&quot;mm&quot;], value[&quot;centroid&quot;])</span>
            <span class="n">ori</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_orientation_new</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;mm&quot;</span><span class="p">])</span>
            <span class="n">orientation</span> <span class="o">+=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">ori</span><span class="p">))</span>
            <span class="n">orientation</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="c1"># orientation += &quot;1, 0\n&quot;</span>
            <span class="n">orientation</span> <span class="o">+=</span> <span class="s2">&quot;1, 0.</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">return</span> <span class="n">orientation</span></div>


<div class="viewcode-block" id="AbaqusWriter._write_section">
<a class="viewcode-back" href="../write_abaqus.html#write_abaqus.AbaqusWriter._write_section">[docs]</a>
    <span class="k">def</span> <span class="nf">_write_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elms</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes the section definition for each element set in the input dictionary.</span>

<span class="sd">        Args:</span>
<span class="sd">        - elms (dict[int, list[int]]): A dictionary containing the element sets for each element.</span>

<span class="sd">        Returns:</span>
<span class="sd">        - section (str): A string containing the section definition for each element set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">section</span> <span class="o">=</span> <span class="s2">&quot;**</span><span class="se">\n</span><span class="s2">** SECTIONS</span><span class="se">\n</span><span class="s2">**</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">elms</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">section</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;*Solid Section, elset=Elset-</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">, material=Material-</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">, orientation=Orient-</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">section</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">section</span></div>


<div class="viewcode-block" id="AbaqusWriter._write_elms">
<a class="viewcode-back" href="../write_abaqus.html#write_abaqus.AbaqusWriter._write_elms">[docs]</a>
    <span class="k">def</span> <span class="nf">_write_elms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elms</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the Abaqus input file for the elements.</span>

<span class="sd">        Args:</span>
<span class="sd">            elms (dict[int, list[int]]): A dictionary containing the element IDs and their corresponding node IDs.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The Abaqus input file for the elements.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">elms_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">element_type</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">gmsh_to_abq_sort</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">27</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elms</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="n">element_type</span> <span class="o">=</span> <span class="s2">&quot;C3D8&quot;</span>  <span class="c1"># 8-node hexahedron</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">elms</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">27</span><span class="p">:</span>
            <span class="c1"># sorting elements from gmsh connectivity to abq connectivity</span>
            <span class="n">gmsh_to_abq_sort</span> <span class="o">=</span> <span class="p">[</span>
                <span class="mi">0</span><span class="p">,</span>
                <span class="mi">1</span><span class="p">,</span>
                <span class="mi">2</span><span class="p">,</span>
                <span class="mi">3</span><span class="p">,</span>
                <span class="mi">4</span><span class="p">,</span>
                <span class="mi">5</span><span class="p">,</span>
                <span class="mi">6</span><span class="p">,</span>
                <span class="mi">7</span><span class="p">,</span>
                <span class="mi">8</span><span class="p">,</span>
                <span class="mi">11</span><span class="p">,</span>
                <span class="mi">13</span><span class="p">,</span>
                <span class="mi">9</span><span class="p">,</span>
                <span class="mi">16</span><span class="p">,</span>
                <span class="mi">18</span><span class="p">,</span>
                <span class="mi">19</span><span class="p">,</span>
                <span class="mi">17</span><span class="p">,</span>
                <span class="mi">10</span><span class="p">,</span>
                <span class="mi">12</span><span class="p">,</span>
                <span class="mi">14</span><span class="p">,</span>
                <span class="mi">15</span><span class="p">,</span>
                <span class="mi">26</span><span class="p">,</span>
                <span class="mi">20</span><span class="p">,</span>
                <span class="mi">25</span><span class="p">,</span>
                <span class="mi">21</span><span class="p">,</span>
                <span class="mi">23</span><span class="p">,</span>
                <span class="mi">24</span><span class="p">,</span>
                <span class="mi">22</span><span class="p">,</span>
            <span class="p">]</span>
            <span class="n">element_type</span> <span class="o">=</span> <span class="s2">&quot;C3D27&quot;</span>

        <span class="n">elms_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;*Element, type=</span><span class="si">{</span><span class="n">element_type</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">sorted_values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">elms</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">element_type</span> <span class="o">==</span> <span class="s2">&quot;C3D27&quot;</span><span class="p">:</span>
                <span class="n">sorted_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">gmsh_to_abq_sort</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">element_type</span> <span class="o">==</span> <span class="s2">&quot;C3D8&quot;</span><span class="p">:</span>
                <span class="n">sorted_values</span> <span class="o">=</span> <span class="n">values</span>
            <span class="n">values_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">sorted_values</span><span class="p">))</span>
            <span class="n">full_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">values_str</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">elms_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">full_str</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">elms_str</span></div>


<div class="viewcode-block" id="AbaqusWriter._write_material">
<a class="viewcode-back" href="../write_abaqus.html#write_abaqus.AbaqusWriter._write_material">[docs]</a>
    <span class="k">def</span> <span class="nf">_write_material</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">abq_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the Abaqus input file for the material properties.</span>

<span class="sd">        Args:</span>
<span class="sd">            elms (dict[int, list[int]]): A dictionary containing the element IDs and their corresponding node IDs.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The Abaqus input file for the material properties.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">umat_name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">abaqus</span><span class="o">.</span><span class="n">umat</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="n">umat_name</span> <span class="o">==</span> <span class="s2">&quot;UMAT_BIPHASIC.f&quot;</span><span class="p">:</span>
            <span class="n">constants_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
            <span class="n">constants_comment</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="s2">&quot;**BVTVcort, BVTVtrab, BPVcort, BPVtrab, eigenvalue min, eigenvalue mid, eigenvalue max&quot;</span>
            <span class="p">)</span>
            <span class="n">i_nb_depvars</span> <span class="o">=</span> <span class="mi">31</span>
            <span class="n">depvars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_depvars</span><span class="p">(</span><span class="n">nb_depvars</span><span class="o">=</span><span class="n">i_nb_depvars</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">umat_name</span> <span class="o">==</span> <span class="s2">&quot;UMAT_QUADRIC_PRIMAL.f&quot;</span><span class="p">:</span>
            <span class="n">constants_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
            <span class="n">constants_comment</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="s2">&quot;**Parameter flag, BVTVbone, BPVbone, eigenvalue min, eigenvalue mid, eigenvalue max, densificator flag, viscosity flag, postyield flag&quot;</span>
            <span class="p">)</span>
            <span class="n">i_nb_depvars</span> <span class="o">=</span> <span class="mi">22</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;UMAT not recognized&quot;</span><span class="p">)</span>

        <span class="n">material</span> <span class="o">=</span> <span class="s2">&quot;**</span><span class="se">\n</span><span class="s2">** MATERIALS</span><span class="se">\n</span><span class="s2">**</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">abq_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">material_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Material-</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">material</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;*Material, name=</span><span class="si">{</span><span class="n">material_name</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">material</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;*User material, constants=</span><span class="si">{</span><span class="n">constants_number</span><span class="si">}</span><span class="s2">, UNSYMM, Type=Mechanical</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">material</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants_comment</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
            <span class="k">if</span> <span class="n">umat_name</span> <span class="o">==</span> <span class="s2">&quot;UMAT_BIPHASIC.f&quot;</span><span class="p">:</span>
                <span class="n">constants</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;RHOc&quot;</span><span class="p">],</span> <span class="mi">5</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;RHOt&quot;</span><span class="p">],</span> <span class="mi">5</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;PHIc&quot;</span><span class="p">],</span> <span class="mi">5</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;PHIt&quot;</span><span class="p">],</span> <span class="mi">5</span><span class="p">),</span>
                    <span class="n">m</span><span class="p">,</span>
                <span class="p">]</span>
                <span class="n">material</span> <span class="o">+=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">constants</span><span class="p">))</span>
                <span class="n">material</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="k">elif</span> <span class="n">umat_name</span> <span class="o">==</span> <span class="s2">&quot;UMAT_QUADRIC_PRIMAL.f&quot;</span><span class="p">:</span>
                <span class="n">constants</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">param_flag</span><span class="p">,</span>
                    <span class="n">value</span><span class="p">[</span><span class="s2">&quot;RHO&quot;</span><span class="p">],</span>
                    <span class="n">value</span><span class="p">[</span><span class="s2">&quot;PHI&quot;</span><span class="p">],</span>
                    <span class="n">m</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">densificator_flag</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">viscosity_flag</span><span class="p">,</span>
                <span class="p">]</span>
                <span class="n">material</span> <span class="o">+=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">constants</span><span class="p">))</span>
                <span class="n">material</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">material</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">postyield_flag</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>  <span class="c1"># avoids having &gt;8 params per line</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;UMAT not recognized&quot;</span><span class="p">)</span>
            <span class="n">material</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;*Depvar</span><span class="se">\n</span><span class="si">{</span><span class="n">i_nb_depvars</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">depvars</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">material</span></div>


<div class="viewcode-block" id="AbaqusWriter._write_boundary_conditions">
<a class="viewcode-back" href="../write_abaqus.html#write_abaqus.AbaqusWriter._write_boundary_conditions">[docs]</a>
    <span class="k">def</span> <span class="nf">_write_boundary_conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">BC_DEF</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">BOTNODES</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the Abaqus input file for boundary conditions.</span>

<span class="sd">        Args:</span>
<span class="sd">            BC_DEF (list[int]): A list containing the boundary condition values.</span>
<span class="sd">            BOTNODES (str): The name of the bottom nodes.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The Abaqus input file for boundary conditions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;**</span><span class="se">\n</span><span class="s2">** BOUNDARY CONDITIONS</span><span class="se">\n</span><span class="s2">**</span><span class="se">\n</span><span class="s2">*Boundary, Type=Displacement</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">part_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">BOTNODES</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">BC_DEF</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">BC_DEF</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">BC_DEF</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span></div>


<div class="viewcode-block" id="AbaqusWriter._write_ref_node">
<a class="viewcode-back" href="../write_abaqus.html#write_abaqus.AbaqusWriter._write_ref_node">[docs]</a>
    <span class="k">def</span> <span class="nf">_write_ref_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">RP_TAG</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">RP</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the Abaqus input file for a reference node.</span>

<span class="sd">        Args:</span>
<span class="sd">            RP_TAG (int): The tag of the reference point.</span>
<span class="sd">            RP (list[float]): The coordinates of the reference point.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The Abaqus input file for a reference node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;*Node</span><span class="se">\n</span><span class="si">{</span><span class="n">RP_TAG</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">RP</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">RP</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">RP</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span></div>


<div class="viewcode-block" id="AbaqusWriter._write_nset">
<a class="viewcode-back" href="../write_abaqus.html#write_abaqus.AbaqusWriter._write_nset">[docs]</a>
    <span class="k">def</span> <span class="nf">_write_nset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NSET</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">NSET_DICT</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the Abaqus input file for a node set.</span>

<span class="sd">        Args:</span>
<span class="sd">            NSET (str): The name of the node set.</span>
<span class="sd">            NSET_DICT (dict[int, int]): A dictionary containing the node IDs and their values.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: A tuple containing the header and values lines of the Abaqus input file for a node set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">head</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;*NSET, NSET=</span><span class="si">{</span><span class="n">NSET</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">NSET_DICT</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">values_chunks</span> <span class="o">=</span> <span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">8</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">),</span> <span class="mi">8</span><span class="p">)]</span>
        <span class="n">values_lines</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">values_chunks</span><span class="p">:</span>
            <span class="n">values_str</span> <span class="o">=</span> <span class="s2">&quot;,</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:&lt;4}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">chunk</span><span class="p">)</span>
            <span class="n">values_lines</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">values_str</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">head</span><span class="p">,</span> <span class="n">values_lines</span></div>


<div class="viewcode-block" id="AbaqusWriter._write_kin_coupling">
<a class="viewcode-back" href="../write_abaqus.html#write_abaqus.AbaqusWriter._write_kin_coupling">[docs]</a>
    <span class="k">def</span> <span class="nf">_write_kin_coupling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NSET</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">NODES</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the Abaqus input file for a kinematic coupling constraint.</span>

<span class="sd">        Args:</span>
<span class="sd">            NSET (str): The name of the reference node set.</span>
<span class="sd">            NODES (str): The name of the nodes set.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The Abaqus input file for a kinematic coupling constraint.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">constraint</span> <span class="o">=</span> <span class="s2">&quot;Kinematic-Coupling&quot;</span>
        <span class="n">surf_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">part_name</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">NODES</span><span class="si">}</span><span class="s2">_CNS_1&quot;</span>
        <span class="n">kin_coupl</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        *Surface, type=NODE, name=</span><span class="si">{</span><span class="n">surf_name</span><span class="si">}</span><span class="s2">, internal</span>
<span class="s2">        </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">part_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">NODES</span><span class="si">}</span><span class="s2">, 1.</span>
<span class="s2">        ** Constraint: </span><span class="si">{</span><span class="n">constraint</span><span class="si">}</span>
<span class="s2">        *Coupling, constraint name=</span><span class="si">{</span><span class="n">constraint</span><span class="si">}</span><span class="s2">, ref node=</span><span class="si">{</span><span class="n">NSET</span><span class="si">}</span><span class="s2">, surface=</span><span class="si">{</span><span class="n">surf_name</span><span class="si">}</span>
<span class="s2">        *Kinematic</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">kin_coupl</span><span class="p">)</span></div>


<div class="viewcode-block" id="AbaqusWriter._write_step">
<a class="viewcode-back" href="../write_abaqus.html#write_abaqus.AbaqusWriter._write_step">[docs]</a>
    <span class="k">def</span> <span class="nf">_write_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">STEP_INC</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">NLGEOM</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the Abaqus input file for a step.</span>

<span class="sd">        Args:</span>
<span class="sd">            STEP_INC (int): The increment for the step.</span>
<span class="sd">            NLGEOM (str): The type of geometry for the step.</span>
<span class="sd">            step_name (str): The name of the step.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The Abaqus input file for a step.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">abaqus</span><span class="o">.</span><span class="n">nlgeom</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">NLGEOM</span> <span class="o">=</span> <span class="s2">&quot;YES&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">abaqus</span><span class="o">.</span><span class="n">nlgeom</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">NLGEOM</span> <span class="o">=</span> <span class="s2">&quot;NO&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;nlgeom must be on or off in configuration file&quot;</span><span class="p">)</span>
        <span class="n">str_comment</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;** STEP: Step-</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="se">\n</span><span class="s2">**</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">str_step</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;*Step, name=Step-</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">, nlgeom=</span><span class="si">{</span><span class="n">NLGEOM</span><span class="si">}</span><span class="s2">, inc=</span><span class="si">{</span><span class="n">STEP_INC</span><span class="si">}</span><span class="s2">, Amplitude=RAMP, unsymm=YES</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">str_comment</span> <span class="o">+</span> <span class="n">str_step</span></div>


<div class="viewcode-block" id="AbaqusWriter._write_output">
<a class="viewcode-back" href="../write_abaqus.html#write_abaqus.AbaqusWriter._write_output">[docs]</a>
    <span class="k">def</span> <span class="nf">_write_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the Abaqus input file for output requests.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The Abaqus input file for output requests.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;**</span>
<span class="s2">        ** OUTPUT REQUESTS</span>
<span class="s2">        **</span>
<span class="s2">        *OUTPUT, FIELD&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">output</span><span class="p">)</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="AbaqusWriter._write_output_history">
<a class="viewcode-back" href="../write_abaqus.html#write_abaqus.AbaqusWriter._write_output_history">[docs]</a>
    <span class="k">def</span> <span class="nf">_write_output_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">REF_NODE</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the Abaqus input file for output history of a reference node.</span>

<span class="sd">        Args:</span>
<span class="sd">            REF_NODE (str): The reference node.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The Abaqus input file for output history of a reference node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out_hist</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            *Node Output</span>
<span class="s2">            U,</span>
<span class="s2">            RF,</span>
<span class="s2">            CF,</span>
<span class="s2">            *Element Output, directions=YES</span>
<span class="s2">            SDV2,</span>
<span class="s2">            SDV15,</span>
<span class="s2">            SDV16,</span>
<span class="s2">            SDV17,</span>
<span class="s2">            SDV18,</span>
<span class="s2">            SDV22,</span>
<span class="s2">            SDV23,</span>
<span class="s2">            SDV24,</span>
<span class="s2">            SDV25,</span>
<span class="s2">            SDV26,</span>
<span class="s2">            SDV27,</span>
<span class="s2">            SDV28,</span>
<span class="s2">            SDV29,</span>
<span class="s2">            SDV30,</span>
<span class="s2">            SDV31,</span>
<span class="s2">            S,</span>
<span class="s2">            LE,</span>
<span class="s2">            COORD,</span>
<span class="s2">            SENER,</span>
<span class="s2">            ** HISTORY OUTPUT</span>
<span class="s2">            *Output, history</span>
<span class="s2">            *Node Output, nset=</span><span class="si">{</span><span class="n">REF_NODE</span><span class="si">}</span>
<span class="s2">            U,</span>
<span class="s2">            RF</span>
<span class="s2">            *NODE PRINT, NSET=REF_NODE, FREQUENCY=1, SUMMARY=NO</span>
<span class="s2">            U,</span>
<span class="s2">            RF</span>
<span class="s2">            *End Step</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">out_hist</span><span class="p">)</span></div>


<div class="viewcode-block" id="AbaqusWriter._write_boundary_conditions_rp">
<a class="viewcode-back" href="../write_abaqus.html#write_abaqus.AbaqusWriter._write_boundary_conditions_rp">[docs]</a>
    <span class="k">def</span> <span class="nf">_write_boundary_conditions_rp</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">RP_TAG</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the Abaqus input file for the boundary conditions of a Reference Point.</span>

<span class="sd">        Args:</span>
<span class="sd">            RP_TAG (str): The reference point tag.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The Abaqus input file for the boundary conditions of a Reference Point.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">magnitude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">loadcase</span><span class="o">.</span><span class="n">load_displacement</span>
        <span class="n">DISPLACEMENT</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">magnitude</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

        <span class="n">bc_str</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        *Static</span>
<span class="s2">        ** Initial increment size, Time period, Min increment size, Max increment size</span>
<span class="s2">        </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">loadcase</span><span class="o">.</span><span class="n">start_step_size</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">loadcase</span><span class="o">.</span><span class="n">time_for_displacement</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">loadcase</span><span class="o">.</span><span class="n">min_step_size</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">loadcase</span><span class="o">.</span><span class="n">max_step_size</span><span class="si">}</span>
<span class="s2">        </span>
<span class="s2">        **</span>
<span class="s2">        ** BOUNDARY CONDITIONS</span>
<span class="s2">        **</span>
<span class="s2">        *Boundary, Type=Displacement</span>
<span class="s2">        </span><span class="si">{</span><span class="n">RP_TAG</span><span class="si">}</span><span class="s2">, 1, 1, </span><span class="si">{</span><span class="n">DISPLACEMENT</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span>
<span class="s2">        </span><span class="si">{</span><span class="n">RP_TAG</span><span class="si">}</span><span class="s2">, 2, 2, </span><span class="si">{</span><span class="n">DISPLACEMENT</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span>
<span class="s2">        </span><span class="si">{</span><span class="n">RP_TAG</span><span class="si">}</span><span class="s2">, 3, 3, </span><span class="si">{</span><span class="n">DISPLACEMENT</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span>
<span class="s2">        </span><span class="si">{</span><span class="n">RP_TAG</span><span class="si">}</span><span class="s2">, 4, 4, </span><span class="si">{</span><span class="n">DISPLACEMENT</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span>
<span class="s2">        </span><span class="si">{</span><span class="n">RP_TAG</span><span class="si">}</span><span class="s2">, 5, 5, </span><span class="si">{</span><span class="n">DISPLACEMENT</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span>
<span class="s2">        </span><span class="si">{</span><span class="n">RP_TAG</span><span class="si">}</span><span class="s2">, 6, 6, </span><span class="si">{</span><span class="n">DISPLACEMENT</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">bc_str</span></div>


<div class="viewcode-block" id="AbaqusWriter.abq_part">
<a class="viewcode-back" href="../write_abaqus.html#write_abaqus.AbaqusWriter.abq_part">[docs]</a>
    <span class="k">def</span> <span class="nf">abq_part</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns information at the part level (Part + Instance).</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The Abaqus input file for the part.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_header</span><span class="p">()</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_parts</span><span class="p">()</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_nodes</span><span class="p">(</span><span class="n">nodes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_elms</span><span class="p">(</span><span class="n">elms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">elms</span><span class="p">)</span>
        <span class="n">BOTNODES_header</span><span class="p">,</span> <span class="n">BOTNODES_SET</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_nset</span><span class="p">(</span><span class="s2">&quot;BOTNODES&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">botnodes</span><span class="p">)</span>
        <span class="n">TOPNODES_header</span><span class="p">,</span> <span class="n">TOPNODES_SET</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_nset</span><span class="p">(</span><span class="s2">&quot;TOPNODES&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">topnodes</span><span class="p">)</span>

        <span class="n">part_t0</span> <span class="o">=</span> <span class="n">header</span> <span class="o">+</span> <span class="n">parts</span> <span class="o">+</span> <span class="n">nodes</span> <span class="o">+</span> <span class="n">elements</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">gen_nset</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;*Nset, nset=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">part_name</span><span class="si">}</span><span class="s2">, generate</span><span class="se">\n</span><span class="s2">1, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span><span class="si">}</span><span class="s2">, 1</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">gen_elset_cort</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;*Elset, elset=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">part_name</span><span class="si">}</span><span class="s2">_CORT, generate</span><span class="se">\n</span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centroids_cort</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centroids_cort</span><span class="p">)</span><span class="si">}</span><span class="s2">, 1</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="n">gen_elset_trab</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;*Elset, elset=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">part_name</span><span class="si">}</span><span class="s2">_TRAB, generate</span><span class="se">\n</span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centroids_trab</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centroids_trab</span><span class="p">)</span><span class="si">}</span><span class="s2">, 1</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="n">part_t1</span> <span class="o">=</span> <span class="n">gen_nset</span> <span class="o">+</span> <span class="n">gen_elset_cort</span> <span class="o">+</span> <span class="n">gen_elset_trab</span>
        <span class="n">part_t2</span> <span class="o">=</span> <span class="n">BOTNODES_header</span> <span class="o">+</span> <span class="n">BOTNODES_SET</span> <span class="o">+</span> <span class="n">TOPNODES_header</span> <span class="o">+</span> <span class="n">TOPNODES_SET</span>

        <span class="n">elsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_elset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elms</span><span class="p">)</span>
        <span class="n">sections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_section</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elms</span><span class="p">)</span>
        <span class="n">orientation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_orientation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abq_dict</span><span class="p">)</span>

        <span class="n">part_t3</span> <span class="o">=</span> <span class="n">elsets</span> <span class="o">+</span> <span class="n">sections</span> <span class="o">+</span> <span class="n">orientation</span>

        <span class="n">part</span> <span class="o">=</span> <span class="n">part_t0</span> <span class="o">+</span> <span class="n">part_t1</span> <span class="o">+</span> <span class="n">part_t2</span> <span class="o">+</span> <span class="n">part_t3</span>
        <span class="n">part</span> <span class="o">+=</span> <span class="s2">&quot;*End Part</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">part</span></div>


<div class="viewcode-block" id="AbaqusWriter.abq_assembly">
<a class="viewcode-back" href="../write_abaqus.html#write_abaqus.AbaqusWriter.abq_assembly">[docs]</a>
    <span class="k">def</span> <span class="nf">abq_assembly</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns information at the assembly level (Assembly + Model Instance).</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The Abaqus input file for the assembly.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">assembly_statement</span> <span class="o">=</span> <span class="s2">&quot;**</span><span class="se">\n</span><span class="s2">** ASSEMBLY</span><span class="se">\n</span><span class="s2">**</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">assembly</span> <span class="o">=</span> <span class="s2">&quot;*Assembly, name=Assembly</span><span class="se">\n</span><span class="s2">**</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">instance</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;*Instance, name=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">part_name</span><span class="si">}</span><span class="s2">, part=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">part_name</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;*Instance, name=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">part_name</span><span class="si">}</span><span class="s2">, part=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">part_name</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">end_instance</span> <span class="o">=</span> <span class="s2">&quot;*End Instance</span><span class="se">\n</span><span class="s2">**</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="n">ref_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_ref_node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RP_tag</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RP_coords</span><span class="p">)</span>

        <span class="c1"># write dictionary of RP tag with index and tag to pass it to _write_nset</span>
        <span class="n">RP_dict</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">RP_tag</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">RP_tag</span><span class="p">}</span>
        <span class="n">ref_node_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_nset</span><span class="p">(</span><span class="s2">&quot;REF_NODE&quot;</span><span class="p">,</span> <span class="n">RP_dict</span><span class="p">)</span>
        <span class="n">ref_node_set_coupling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_kin_coupling</span><span class="p">(</span><span class="s2">&quot;REF_NODE&quot;</span><span class="p">,</span> <span class="s2">&quot;TOPNODES&quot;</span><span class="p">)</span>
        <span class="n">end_assembly</span> <span class="o">=</span> <span class="s2">&quot;*End Assembly</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="n">abq_assembly</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">assembly_statement</span>
            <span class="o">+</span> <span class="n">assembly</span>
            <span class="o">+</span> <span class="n">instance</span>
            <span class="o">+</span> <span class="n">end_instance</span>
            <span class="o">+</span> <span class="n">ref_node</span>
            <span class="o">+</span> <span class="n">ref_node_set</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># header</span>
            <span class="o">+</span> <span class="n">ref_node_set</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># set</span>
            <span class="o">+</span> <span class="n">ref_node_set_coupling</span>
            <span class="o">+</span> <span class="n">end_assembly</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">abq_assembly</span></div>


<div class="viewcode-block" id="AbaqusWriter.abq_model">
<a class="viewcode-back" href="../write_abaqus.html#write_abaqus.AbaqusWriter.abq_model">[docs]</a>
    <span class="k">def</span> <span class="nf">abq_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes the Abaqus input file for the model.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The Abaqus input file for the model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">materials</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_material</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abq_dict</span><span class="p">)</span>
        <span class="c1"># materials = self._write_material_test(self.abq_dict)</span>
        <span class="n">boundary_conditions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_boundary_conditions</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;BOTNODES&quot;</span><span class="p">)</span>
        <span class="n">spacing</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;** ----------------------------------------------------------------</span><span class="se">\n</span><span class="s2">**</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_step</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">STEP_INC</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NLGEOM</span><span class="p">,</span> <span class="n">step_name</span><span class="o">=</span><span class="s2">&quot;Compression&quot;</span><span class="p">)</span>
        <span class="n">boundary_conditions_ref_point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_boundary_conditions_rp</span><span class="p">(</span>
            <span class="n">RP_TAG</span><span class="o">=</span><span class="s2">&quot;REF_NODE&quot;</span>
        <span class="p">)</span>

        <span class="n">model</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">materials</span>
            <span class="o">+</span> <span class="n">boundary_conditions</span>
            <span class="o">+</span> <span class="n">spacing</span>
            <span class="o">+</span> <span class="n">step</span>
            <span class="o">+</span> <span class="n">boundary_conditions_ref_point</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">model</span></div>


<div class="viewcode-block" id="AbaqusWriter.abq_history">
<a class="viewcode-back" href="../write_abaqus.html#write_abaqus.AbaqusWriter.abq_history">[docs]</a>
    <span class="k">def</span> <span class="nf">abq_history</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes the Abaqus input file for the output history.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The Abaqus input file for the output history.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_output</span><span class="p">()</span>
        <span class="n">output_history</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_output_history</span><span class="p">(</span><span class="n">REF_NODE</span><span class="o">=</span><span class="s2">&quot;REF_NODE&quot;</span><span class="p">)</span>
        <span class="n">history</span> <span class="o">=</span> <span class="n">output</span> <span class="o">+</span> <span class="n">output_history</span>
        <span class="k">return</span> <span class="n">history</span></div>


<div class="viewcode-block" id="AbaqusWriter.abaqus_writer">
<a class="viewcode-back" href="../write_abaqus.html#write_abaqus.AbaqusWriter.abaqus_writer">[docs]</a>
    <span class="nd">@timefunc</span>
    <span class="k">def</span> <span class="nf">abaqus_writer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_ver</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes the Abaqus input file for the current part.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">inp_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">part_name</span><span class="si">}</span><span class="s2">_V_</span><span class="si">{</span><span class="n">_ver</span><span class="si">}</span><span class="s2">.inp&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">inp_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abq_part</span><span class="p">())</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abq_assembly</span><span class="p">())</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abq_model</span><span class="p">())</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abq_history</span><span class="p">())</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input file saved in </span><span class="si">{</span><span class="n">inp_path</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">inp_path</span></div>


<div class="viewcode-block" id="AbaqusWriter.abq_dictionary">
<a class="viewcode-back" href="../write_abaqus.html#write_abaqus.AbaqusWriter.abq_dictionary">[docs]</a>
    <span class="k">def</span> <span class="nf">abq_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">umat_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1"># concatenate cort with trab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">m_cort_np</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_trab_np</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">mm_cort</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mm_trab</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># make RHOc, RHOt, PHIc, PHIt a dictionary with element number as key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RHOc</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">RHOc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centroids_cort</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RHOt</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">RHOt</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centroids_trab</span><span class="p">)}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">PHIc</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">PHIc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centroids_cort</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PHIt</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">PHIt</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centroids_trab</span><span class="p">)}</span>

        <span class="n">abq_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># keys: element number</span>
        <span class="c1"># values: centroids, mm, elset, RHOc, RHOt, PHIc, PHIt</span>
        <span class="c1"># ! remember to change the name of the UMAT in the if statement</span>
        <span class="k">if</span> <span class="n">umat_name</span> <span class="o">==</span> <span class="s2">&quot;UMAT_BIPHASIC.f&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">centroids_cort</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">abq_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;centroid&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
                    <span class="s2">&quot;m&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">key</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="s2">&quot;mm&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mm</span><span class="p">[</span><span class="n">key</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="s2">&quot;elset&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">elms</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
                    <span class="s2">&quot;RHOc&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">RHOc</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
                    <span class="s2">&quot;RHOt&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s2">&quot;PHIc&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">PHIc</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
                    <span class="s2">&quot;PHIt&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="p">}</span>

            <span class="c1"># keys: element number</span>
            <span class="c1"># values: centroids, mm, elset, RHOc, RHOt, PHIc, PHIt</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">centroids_trab</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">abq_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;centroid&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
                    <span class="s2">&quot;m&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">key</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="s2">&quot;mm&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mm</span><span class="p">[</span><span class="n">key</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="s2">&quot;elset&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">elms</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
                    <span class="s2">&quot;RHOc&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s2">&quot;RHOt&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">RHOt</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
                    <span class="s2">&quot;PHIc&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s2">&quot;PHIt&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">PHIt</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
                <span class="p">}</span>

        <span class="k">elif</span> <span class="n">umat_name</span> <span class="o">==</span> <span class="s2">&quot;UMAT_QUADRIC_PRIMAL.f&quot;</span><span class="p">:</span>
            <span class="c1"># merge cort and trab into single dictionary</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">centroids</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centroids_cort</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">centroids</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centroids_trab</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RHO</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RHOc</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RHO</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RHOt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PHI</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PHIc</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PHI</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PHIt</span><span class="p">)</span>

            <span class="c1"># keys: element number</span>
            <span class="c1"># values: centroids, mm, elset, RHO, PHI</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">centroids</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">abq_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;centroid&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
                    <span class="s2">&quot;m&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">key</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="s2">&quot;mm&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mm</span><span class="p">[</span><span class="n">key</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="s2">&quot;elset&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">elms</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
                    <span class="s2">&quot;RHO&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">RHO</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
                    <span class="s2">&quot;PHI&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">PHI</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
                <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;UMAT not recognized&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">abq_dict</span> <span class="o">=</span> <span class="n">abq_dict</span>
        <span class="k">return</span> <span class="n">abq_dict</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Simone Poncioni.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>